<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eat.regist.RegistDAO">

<!-- 코스 작성 몸통 -->
<insert id="regist_write" parameterType="com.eat.main.CourseDTO"
	useGeneratedKeys="true" keyColumn="post_idx" keyProperty="post_idx">
	INSERT INTO post (user_id, subject, post_cmt, public, tmp)
	VALUES (#{user_id}, #{subject}, #{post_cmt}, #{ispublic}, #{tmp})
</insert>

<!-- 코스 작성 타임라인 -->
<insert id="regist_time" parameterType="com.eat.main.TimelineDTO">
	INSERT INTO timeline (post_idx, start, end)
	VALUES (#{param2},#{param1.start},#{param1.end})
</insert>

<!-- 코스 작성 세부일정-식당 -->
<insert id="regist_detail_resta" parameterType="com.eat.main.DetailRestaDTO"
	useGeneratedKeys="true" keyColumn="detail_idx" keyProperty="detail_idx">
	INSERT INTO detail_restaurant (post_idx, resta_idx, comment, start)
	VALUES (#{post_idx}, #{resta_idx}, #{comment}, #{start})
</insert>

<!-- 코스 작성 세부일정-코멘트만 -->
<insert id="regist_detail_cmt" parameterType="com.eat.main.DetailCmtDTO"
	useGeneratedKeys="true" keyColumn="detail_idx" keyProperty="detail_idx">
	INSERT INTO detail_comment (post_idx, comment, start)
	VALUES (#{post_idx}, #{comment}, #{start})
</insert>

<!-- 코스 작성 코스태그 -->
<insert id="regist_tags" parameterType="com.eat.main.CourseTagDTO">
	INSERT INTO tag_course (post_idx, idx, class)
	VALUES (#{post_idx}, #{idx}, #{isclass})
</insert>

<!-- 코스 작성 임시저장 리스트 -->
<select id="regist_tmp_list" resultType="com.eat.main.CourseDTO">
	SELECT 
		subject
		,reg_date
	FROM post
	WHERE user_id = #{param1} AND tmp = true
	ORDER BY reg_date DESC
	LIMIT #{param3} OFFSET #{param2}
</select>

<!-- 코스 작성 임시저장 리스트 수-->
<select id="regist_tmp_cnt" resultType="int">
	SELECT count(post_idx) AS cnt
	FROM post
	WHERE user_id = #{param1} AND tmp = true
</select>

<!-- 페이지 -->
<select id="pages" resultType="int">
	SELECT CEIL(COUNT(post_idx)/#{param1}) AS pages FROM post
</select>

</mapper>